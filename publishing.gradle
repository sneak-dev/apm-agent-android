apply plugin: 'maven-publish'

afterEvaluate {
    publishing {
        publications {
            if (!project.plugins.hasPlugin("java-gradle-plugin")) {
                maven(MavenPublication) {
                    if (project.extensions.findByName("android") == null) {
                        // it's a plain java project
                        from components.java
                    } else {
                        // it's an android project
                        from components.debug
                    }
                }
            }
        }
    }
}